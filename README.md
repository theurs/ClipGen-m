# ClipGen-M - Универсальный интерфейс для LLM

[![Go Version](https://img.shields.io/github/go-mod/go-version/Vladimir37/clipgen-m)](go.mod)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![Platform](https://img.shields.io/badge/platform-Windows-blue)]()

## Описание

ClipGen-M - это набор утилит для взаимодействия с различными LLM (Large Language Models), включая Mistral, Google Gemini, GitHub Copilot и Groq. Проект предоставляет унифицированный интерфейс командной строки для работы с различными моделями искусственного интеллекта.

## Особенности

- **Унифицированный интерфейс**: Все утилиты используют одинаковые флаги командной строки
- **Поддержка мультимедиа**: Работа с изображениями, аудио, PDF и текстовыми файлами
- **Поддержка чатов**: Сохранение истории чатов и контекста
- **Автоматическая конвертация аудио**: Поддержка редких форматов (AMR и др.) через ffmpeg
- **Графический интерфейс**: Встроенный ChatUI для удобной работы
- **Системный трей**: Управление через иконку в трее Windows
- **Интеграция с буфером обмена**: Автоматическая обработка данных из буфера обмена с помощью ИИ
- **Горячие клавиши**: Поддержка настраиваемых хоткеев для быстрого доступа к функциям
- **Работа с выделенным текстом**: Возможность обработки выделенного текста без копирования


## Структура проекта

- `cmd/clipgen-m` - основное приложение с системным треем
- `cmd/chatui` - графический интерфейс для чатов
- `cmd/geminillm` - утилита для Google Gemini
- `cmd/ghllm` - утилита для GitHub Copilot
- `cmd/groqllm` - утилита для Groq
- `cmd/pollinationsllm` - утилита для Pollinations AI (поддержка инструментов, поиска через gemini-search, калькулятора Lua)
- `cmd/mistral` - утилита для Mistral (оригинальная)

## Основной модуль ClipGen-m (буфер обмена)

Основной модуль `clipgen-m` представляет собой приложение, которое работает в системном трее Windows и предоставляет мощные функции для работы с буфером обмена. Он позволяет автоматически обрабатывать данные из буфера обмена с помощью различных LLM-моделей.

### Основные функции:

- **Обработка буфера обмена**: Автоматическая обработка текста, изображений и файлов из буфера обмена
- **Поддержка различных типов данных**: Текст, изображения, файлы и пути к файлам
- **Работа с выделенным текстом**: Возможность обработки выделенного текста без его копирования в буфер
- **OCR-функции**: Извлечение текста с изображений через буфер обмена
- **Переключение раскладки**: Функция "Punto Switcher" для быстрого переключения между русской и английской раскладками
- **Интеграция с различными LLM**: Поддержка Mistral, Google Gemini, GitHub Copilot, Groq и других моделей

### Поддерживаемые форматы данных:

- **Текст**: Любой текст из буфера обмена или выделенный текст
- **Изображения**: PNG, JPG, JPEG, BMP, WEBP и другие форматы
- **Файлы**: Прямая обработка файлов, помещенных в буфер обмена
- **Пути к файлам**: Обработка файлов по указанным в буфере путям

## Унифицированные флаги командной строки

Все LLM-утилиты поддерживают унифицированный набор флагов с поддержкой как одинарных (-), так и двойных (--) дефисов:

- `-f` / `--f` / `--file` - файлы (поддерживаются изображения, аудио и текстовые файлы)
- `-s` / `--s` / `--system` / `--system-prompt` - системный промпт
- `-j` / `--j` / `--json` - JSON режим
- `-m` / `--m` / `--mode` - режим модели (auto, general, code, ocr, audio, vision)
- `-t` / `--t` / `--temp` / `--temperature` - температура
- `-v` / `--v` / `--verbose` - подробный вывод
- `--save-key` - сохранение ключа
- `-chat` / `--chat` / `--chat-id` - ID чата

## Чат-функциональность

ClipGen-m предоставляет мощную чат-функциональность через встроенный графический интерфейс ChatUI и систему управления чатами.

### Основные возможности чата:

- **Графический интерфейс**: Удобное окно чата с поддержкой форматирования и истории
- **Управление чатами**: Создание, сохранение и переключение между различными чатами
- **Поддержка файлов**: Возможность прикрепления файлов и изображений к сообщениям
- **Несколько провайдеров**: Поддержка различных LLM-провайдеров (Mistral, Gemini, GitHub Copilot, Groq)
- **Настройка параметров**: Возможность настройки температуры, системного промпта и режимов для каждого чата
- **История сообщений**: Сохранение полной истории переписки с контекстом

### Быстрый доступ к чату:

- **Горячая клавиша**: По умолчанию `Ctrl+M` для быстрого открытия/закрытия окна чата
- **Системный трей**: Возможность запуска чата через иконку в системном трее
- **Интеграция с буфером**: Возможность отправки содержимого буфера обмена напрямую в чат

### Поддерживаемые провайдеры:

- **Mistral**: По умолчанию, поддержка различных моделей Mistral
- **Google Gemini**: Интеграция с Google Gemini API
- **GitHub Copilot/Chat**: Использование GitHub Copilot и связанных моделей
- **Groq**: Поддержка моделей от Groq
- **Pollinations AI**: Интеграция с API Pollinations, включая инструменты (калькулятор Lua, поиск через Tavily и native поиск через gemini-search)

## Горячие клавиши и действия

ClipGen-m поддерживает настраиваемые горячие клавиши для быстрого доступа к различным функциям. По умолчанию включены следующие действия:

### Стандартные действия:

- **Сменить раскладку (Punto)**: `Pause` - переключение между русской и английской раскладками
- **Исправить текст**: `Ctrl+F1` - грамматическая и стилистическая проверка текста
- **Выполнить просьбу**: `Ctrl+F2` - выполнение произвольной команды над текстом
- **Перевести и показать**: `Ctrl+F3` - перевод текста с открытием в редакторе
- **Перевести и заменить**: `Ctrl+F4` - перевод текста с заменой в текущем месте
- **OCR / Текст с картинки**: `Ctrl+F6` - извлечение текста с изображений
- **Умный анализ**: `Ctrl+F8` - подробный анализ данных с запросом задачи у пользователя

### Управление приложением:

- **Переключение состояния**: `Ctrl+F12` - включение/выключение обработки горячих клавиш
- **Открытие чата**: `Ctrl+M` - быстрое открытие/закрытие окна чата

### Настройка горячих клавиш:

Горячие клавиши настраиваются в файле `config.yaml` в разделе `actions`. Каждое действие может иметь:
- `name` - название действия
- `hotkey` - комбинация клавиш
- `prompt` - системный промпт для LLM
- `input_type` - тип входных данных (auto, text, image, files, layout_switch)
- `output_mode` - режим вывода (replace, editor)

## Системный трей и интерфейс

ClipGen-m работает как приложение в системном трее Windows, обеспечивая постоянную доступность функций без необходимости держать окно открытым.

### Основные элементы интерфейса:

- **Иконка в трее**: Отображает текущее состояние приложения (активно/неактивно)
- **Контекстное меню**: Доступ к основным функциям через правый клик по иконке
- **Индикаторы состояния**:
  - **Зеленая иконка**: Приложение активно и обрабатывает горячие клавиши
  - **Желтая иконка**: Выполняется обработка запроса
  - **Красная иконка**: Приложение отключено

### Функции системного трея:

- **Переключение состояния**: Чекбокс "Активен" для включения/выключения обработки горячих клавиш
- **Доступ к конфигурации**: Прямое редактирование всех конфигурационных файлов
- **Доступ к логам**: Просмотр файлов логов для диагностики проблем
- **Управление приложением**: Перезагрузка и выход из приложения

### Контекстное меню:

Через контекстное меню доступны следующие функции:
- Включение/выключение обработки клавиш
- Редактирование конфигурационных файлов
- Просмотр файлов логов
- Перезагрузка приложения
- Завершение работы

## Быстрый доступ к конфигам и логам

В контекстное меню ClipGen-m добавлены пункты для быстрого доступа:

### Конфигурационные файлы:
- `Настройки (main)` - редактировать config.yaml
- `Mistral Config` - редактировать mistral.conf
- `Tavily Config` - редактировать tavily.conf
- `Geminillm Config` - редактировать gemini.conf
- `Ghllm Config` - редактировать github.conf
- `Groqllm Config` - редактировать groq.conf
- `Pollinations Config` - редактировать pollinations.conf

### Файлы логов:
- `Mistral Log` - просмотр mistral_err.log
- `Geminillm Log` - просмотр gemini_err.log
- `Ghllm Log` - просмотр github_err.log
- `Groqllm Log` - просмотр groq_err.log
- `ClipGen Log` - просмотр ошибок программы
- `Pollinations Log` - просмотр pollinations_err.log

## Конфигурация

ClipGen-m использует YAML-файл конфигурации `config.yaml`, который автоматически создается при первом запуске в директории `%APPDATA%\clipgen-m\`.

### Структура config.yaml:

```yaml
# --- СИСТЕМНЫЕ НАСТРОЙКИ ---
editor_path: "notepad.exe"                    # Путь к редактору для открытия файлов
llm_path: "mistral.exe"                      # Путь к основной LLM-утилите
app_toggle_hotkey: "Ctrl+F12"                # Горячая клавиша для включения/выключения приложения
chatui_path: ".\\ClipGen-m-chatui.exe"       # Путь к исполняемому файлу ChatUI
chatui_hotkey: "Ctrl+M"                      # Горячая клавиша для открытия чата
system_prompt: |                             # Системный промпт по умолчанию
  Вы работаете в Windows-утилите ClipGen-m, которая помогает отправлять запросы к ИИ-моделям через буфер обмена.
  Используйте табуляцию для разделения столбцов в таблицах, это необходимо для возможности вставки текста в Excel.
  Не добавляйте вступительные заполнители. Используй простой текст без маркдауна.

actions:                                      # Список пользовательских действий
  - name: "Сменить раскладку (Punto)"        # Название действия
    hotkey: "Pause"                          # Горячая клавиша
    input_type: "layout_switch"              # Тип обработки (layout_switch)
    output_mode: "replace"                   # Режим вывода (replace, editor)
  - name: "Исправить текст (F1)"
    hotkey: "Ctrl+F1"
    prompt: |
      Исправь грамматику, пунктуацию и стиль. Не надо переводить на другой язык. Верни ТОЛЬКО исправленный текст.
      Текст: {{.clipboard}}
    input_type: "text"
    output_mode: "replace"
  - name: "Выполнить просьбу (F2)"
    hotkey: "Ctrl+F2"
    prompt: "Выполни просьбу:\n{{.clipboard}}"
    input_type: "text"
    output_mode: "replace"
  # ... другие действия
```

### Типы input_type:

- `auto` - автоматическое определение типа данных (текст, изображение, файлы)
- `text` - обработка текста из буфера или выделения
- `image` - обработка изображений
- `files` - обработка файлов из буфера
- `layout_switch` - переключение раскладки клавиатуры

### Режимы output_mode:

- `replace` - замена текущего содержимого (вставка результата с Ctrl+V)
- `editor` - открытие результата в редакторе
- `notepad` - синоним для editor

### Специальные переменные в промптах:

- `{{.clipboard}}` - содержимое буфера обмена
- `{{ask_user}}` - запрос дополнительной информации у пользователя во время выполнения

## Сборка

Каждая утилита имеет собственный `build.bat` файл для простой сборки:

- `mistral/build.bat`
- `geminillm/build.bat`
- `ghllm/build.bat`
- `groqllm/build.bat`
- `clipgen-m/build.bat`
- `chatui/build.bat`

Для сборки выполните:
```
cd cmd\[утилита]
call build.bat
```

## Использование

Все утилиты принимают входные данные через stdin и поддерживают работу с файлами, изображениями и аудио (в зависимости от модели и API возможностей).

Поддержка файлов:
- `mistral.exe` - поддерживает изображения, аудио, текстовые файлы, PDF (через OCR)
- `geminillm.exe` - поддерживает изображения, текстовые файлы, аудио (включая автоматическую конвертацию неподдерживаемых форматов с помощью ffmpeg)
- `ghllm.exe` - поддерживает изображения, текстовые файлы, аудио
- `groqllm.exe` - поддерживает изображения, аудио, текстовые файлы
- `pollinationsllm.exe` - поддерживает изображения, аудио, текстовые файлы, PDF (через OCR), с поддержкой инструментов (калькулятор Lua, поиск)

Примеры:
```
echo "Привет" | mistral.exe --system "Ты помощник" --temperature 0.7
echo "Привет" | geminillm.exe --system "Ты помощник" --temperature 0.7
echo "Привет" | ghllm.exe --mode general --json
echo "Привет" | groqllm.exe --chat mychat --temperature 0.5
```

## Расположение файлов

Конфигурационные файлы и логи хранятся в:
`%APPDATA%\clipgen-m\`

## Требования

- Windows 10/11
- Go 1.25+
- (Опционально) FFmpeg для поддержки редких аудио форматов

## Вклад в проект

См. [CONTRIBUTING.md](CONTRIBUTING.md) для подробной информации о том, как внести свой вклад в проект.

## Кодекс поведения

См. [CODE_OF_CONDUCT.md](CODE_OF_CONDUCT.md) для ознакомления с нашими правилами поведения.

## Лицензия

Этот проект лицензирован под [MIT License](LICENSE). См. файл [LICENSE](LICENSE) для получения дополнительной информации.

## Авторы

См. [AUTHORS](AUTHORS) для списка участников проекта.