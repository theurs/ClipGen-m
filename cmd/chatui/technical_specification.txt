# Техническое задание: ClipGen-m-chatui

## 1. Общие сведения

**Название проекта:** ClipGen-m-chatui (GUI-интерфейс для чата с ИИ)  
**Тип проекта:** Desktop-приложение для Windows  
**Язык программирования:** Go (Golang)  
**Целевая платформа:** Microsoft Windows (7/8/10/11)  
**Тип приложения:** Standalone GUI-приложение с нативным интерфейсом

## 2. Цель проекта

Создать настольное GUI-приложение для Windows, обеспечивающее удобный интерфейс для работы с чатами ИИ через интеграцию с утилитой `mistral.exe`. Приложение должно быть легковесным, быстро запускаемым и предоставлять все возможности командной строки в удобном визуальном интерфейсе.

## 3. Функциональные требования

### 3.1. Основной интерфейс
- **Главное окно:**
  - Размер: 60% пикселей по умолчанию
  - Позиционирование: по центру экрана при первом запуске
  - Возможность изменения размера, позиции и всех настроек в окне пользователем
  - Заголовок: "ClipGen-m ChatUI"

- **Сохранение состояния окна:**
  - Сохранение размеров окна (ширина, высота)
  - Сохранение позиции окна (координаты X, Y)
  - Сохранение всех настроек окна
  - Восстановление всех при следующем запуске
  - Файл конфигурации: `%AppData%\clipgen-m\chatui_config.json`

### 3.2. Панель инструментов
- **Выбор чата:**
  - Выпадающий список с доступными чатами
  - Возможность выбора активного чата по ID
  - Автоматическое обновление списка из папки `%AppData%\clipgen-m\mistral_chats\`
  - Сохранение выбранного чата в конфигурации

- **Настройки темы:**
  - Выбор темы: "Авто" / "Светлая" / "Темная"
  - Сохранение выбранной темы в конфигурации
  - Применение темы ко всем элементам интерфейса

- **Настройки поведения клавиатуры:**
  - Переключатель: "Отправлять по Enter" / "Отправлять по Ctrl+Enter"
  - Сохранение выбранного поведения в конфигурации
  - Визуальная индикация текущего режима

- **Кнопка прикрепления файлов:**
  - Открытие диалога выбора файлов
  - Возможность выбора одного или нескольких файлов
  - Визуальное отображение прикрепленных файлов

### 3.3. Рабочая область чата
- **Область отображения истории чата:**
  - Прокручиваемая текстовая область
  - Возможность прокрутки колесиком мыши и полосой прокрутки
  - Автоматическая прокрутка к последнему сообщению
  - Различное оформление для сообщений пользователя и ИИ (цвет, выравнивание)
  - Отображение меток "Вы:" и "AI:" перед каждым сообщением

- **Область ввода сообщения:**
  - Многострочное текстовое поле
  - Поддержка переноса строк (Enter для новой строки)
  - Отправка сообщения по горячей клавише (Enter или Ctrl+Enter в зависимости от настройки)
  - Поддержка вставки текста (Ctrl+V) и файлов (Ctrl+V с файлами из проводника)

- **Область прикрепленных файлов:**
  - Визуальное отображение списка прикрепленных файлов
  - Отображение базовых имен файлов
  - Возможность очистки списка при отправке сообщения

### 3.4. Функции обмена файлами
- **Прикрепление файлов:**
  - Через кнопку "Прикрепить файлы" (открытие диалога)
  - Через Drag & Drop в область приложения
  - Через комбинацию клавиш Ctrl+V (если в буфере содержатся пути к файлам)

- **Ограничения:**
  - Поддержка всех типов файлов, поддерживаемых mistral.exe (-f флаг)
  - Отображение только имен файлов, а не полных путей в интерфейсе

## 4. Интеграция с внешними компонентами

### 4.1. Интеграция с mistral.exe
- **Вызов команд:**
  - `mistral.exe -chat <chat_id>` для отправки сообщений в определенный чат
  - `mistral.exe -f <file_path>` для прикрепления файлов
  - Передача текста сообщения через stdin

- **Обработка результатов:**
  - Отображение ответа ИИ в области чата
  - Обработка ошибок и отображение сообщений об ошибках
  - Обновление истории чата только после успешного получения ответа

### 4.2. Работа с файлами чатов
- **Чтение списка чатов:**
  - Сканирование папки `%AppData%\clipgen-m\mistral_chats\`
  - Поиск файлов с расширением `.json`
  - Использование имен файлов (без расширения) как ID чатов

## 5. Нефункциональные требования

### 5.1. Производительность
- Быстрый запуск (менее 2 секунд)
- Отзывчивый интерфейс без задержек при вводе текста

### 5.2. Совместимость
- Поддержка Windows 7 и выше
- Совместимость с разрешениями экрана от 1024x768
- Поддержка масштабирования Windows (100%, 125%, 150%)

### 5.3. Безопасность
- Безопасная обработка пользовательских файлов
- Проверка путей к файлам на корректность
- Защита от внедрения вредоносного кода через сообщения

## 6. Требования к реализации

### 6.1. Архитектура приложения
- Использование нативного Windows GUI без web-технологий
- Чистый Go-код без необходимости в CGO

### 6.2. Управление состоянием
- Сохранение и загрузка всех настроек в JSON-файл
- Обработка корректного завершения приложения
- Восстановление состояния при следующем запуске

### 6.3. Обработка ошибок
- Валидация вводимых данных
- Обработка ошибок подключения к ИИ
- Ведение логов ошибок в файл

## 7. Сценарии использования

### 7.1. Стандартный сеанс
1. Пользователь запускает приложение
2. Приложение восстанавливает предыдущее состояние (размер, позиция, выбранный чат)
3. Пользователь вводит сообщение в текстовое поле
4. Пользователь отправляет сообщение (Enter или Ctrl+Enter в зависимости от настройки)
5. Приложение вызывает mistral.exe с соответствующими параметрами
6. Приложение отображает ответ ИИ в области чата

### 7.2. Работа с файлами
1. Пользователь прикрепляет файл(ы) через кнопку или Drag&Drop
2. Приложение отображает список прикрепленных файлов
3. Пользователь отправляет сообщение с прикрепленными файлами
4. Приложение передает файлы в вызов mistral.exe
5. Приложение отображает ответ ИИ

### 7.3. Переключение между чатами
1. Пользователь выбирает другой чат из выпадающего списка
2. Приложение отображает историю выбранного чата
3. Последующие сообщения будут отправляться в выбранный чат

## 8. Требования к тестированию

- Тестирование на разных версиях Windows
- Тестирование с различными размерами окна
- Проверка корректности сохранения/восстановления настроек
- Проверка работы с файлами различных типов и размеров
- Проверка обработки ошибок и сбоев mistral.exe

## 9. Критерии готовности

- Приложение успешно компилируется и запускается на целевых ОС
- Реализованы все функциональные требования
- Сохранение и восстановление настроек работает корректно
- Интеграция с mistral.exe функционирует
- Приложение не имеет утечек памяти и критических ошибок
- Интерфейс интуитивно понятен и удобен в использовании